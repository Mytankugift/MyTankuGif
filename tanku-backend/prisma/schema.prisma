generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                       String                    @id @default(cuid())
  email                    String                    @unique
  password                 String?
  firstName                String?                   @map("first_name")
  lastName                 String?                   @map("last_name")
  phone                    String?
  emailVerified            Boolean                   @default(false) @map("email_verified")
  createdAt                DateTime                  @default(now()) @map("created_at")
  updatedAt                DateTime                  @updatedAt @map("updated_at")
  username                 String?                   @unique
  addresses                Address[]
  carts                    Cart[]
  conversationParticipants ConversationParticipant[]
  friendOf                 Friend[]                  @relation("FriendOf")
  friends                  Friend[]                  @relation("UserFriends")
  groupMembers             GroupMember[]
  groups                   Group[]                   @relation("GroupOwner")
  messages                 Message[]
  notifications            Notification[]
  orders                   Order[]
  personalInfo             PersonalInformation?
  posterComments           PosterComment[]
  posterReactions          PosterReaction[]
  posters                  Poster[]
  productLikes             ProductLike[]
  savedWishlists           SavedWishlist[]
  stalkerGiftsReceived     StalkerGift[]             @relation("Recipient")
  stalkerGifts             StalkerGift[]             @relation("Giver")
  stories                  StoriesUser[]
  categoryInterests        UserCategoryInterest[]    @relation("UserCategoryInterests")
  consents                 UserConsent[]
  profile                  UserProfile?
  wishLists                WishList[]
  wishlistAccessRequests   WishlistAccessRequest[]   @relation("WishlistAccessRequests")

  @@map("users")
}

model UserProfile {
  id                     String   @id @default(cuid())
  userId                 String   @unique @map("user_id")
  avatar                 String?
  banner                 String?
  bio                    String?
  createdAt              DateTime @default(now()) @map("created_at")
  updatedAt              DateTime @updatedAt @map("updated_at")
  isPublic               Boolean  @default(true) @map("is_public")
  socialLinks            Json?    @map("social_links")
  allowGiftShipping      Boolean  @default(true) @map("allow_gift_shipping")
  useMainAddressForGifts Boolean  @default(false) @map("use_main_address_for_gifts")
  user                   User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_profiles")
}

model PersonalInformation {
  id            String    @id @default(cuid())
  userId        String    @unique @map("user_id")
  pseudonym     String?
  statusMessage String?   @map("status_message")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  birthDate     DateTime? @map("birth_date")
  metadata      Json?
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("personal_information")
}

model UserCategoryInterest {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  categoryId String   @map("category_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  user       User     @relation("UserCategoryInterests", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, categoryId])
  @@index([userId])
  @@index([categoryId])
  @@map("user_category_interests")
}

model Category {
  id            String                 @id @default(cuid())
  name          String
  handle        String                 @unique
  description   String?
  parentId      String?                @map("parent_id")
  createdAt     DateTime               @default(now()) @map("created_at")
  updatedAt     DateTime               @updatedAt @map("updated_at")
  dropiId       Int?                   @unique @map("dropi_id")
  parent        Category?              @relation("CategoryTree", fields: [parentId], references: [id])
  children      Category[]             @relation("CategoryTree")
  products      Product[]
  userInterests UserCategoryInterest[]

  @@index([dropiId])
  @@map("categories")
}

model Product {
  id            String           @id @default(cuid())
  title         String
  handle        String           @unique
  description   String?
  images        String[]
  categoryId    String?          @map("category_id")
  active        Boolean          @default(true)
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")
  orderItems    OrderItem[]
  productLikes  ProductLike[]
  variants      ProductVariant[]
  category      Category?        @relation(fields: [categoryId], references: [id])
  stalkerGifts  StalkerGift[]
  wishListItems WishListItem[]
  stories       StoriesUser[]

  @@map("products")
}

model ProductVariant {
  id                String             @id @default(cuid())
  productId         String             @map("product_id")
  sku               String             @unique
  title             String
  price             Int
  stock             Int                @default(0)
  active            Boolean            @default(true)
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")
  attributes        Json?
  suggestedPrice    Int?               @map("suggested_price")
  tankuPrice        Int?               @map("tanku_price")
  cartItems         CartItem[]
  orderItems        OrderItem[]
  product           Product            @relation(fields: [productId], references: [id], onDelete: Cascade)
  stalkerGifts      StalkerGift[]
  warehouseVariants WarehouseVariant[]
  wishListItems     WishListItem[]

  @@map("product_variants")
}

model Cart {
  id              String     @id @default(cuid())
  userId          String?    @map("user_id")
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")
  metadata        Json?
  giftRecipientId String?    @map("gift_recipient_id")
  isGiftCart      Boolean    @default(false) @map("is_gift_cart")
  items           CartItem[]
  user            User?      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([giftRecipientId])
  @@map("carts")
}

model CartItem {
  id        String         @id @default(cuid())
  cartId    String         @map("cart_id")
  variantId String         @map("variant_id")
  quantity  Int
  createdAt DateTime       @default(now()) @map("created_at")
  updatedAt DateTime       @updatedAt @map("updated_at")
  cart      Cart           @relation(fields: [cartId], references: [id], onDelete: Cascade)
  variant   ProductVariant @relation(fields: [variantId], references: [id])

  @@unique([cartId, variantId])
  @@map("cart_items")
}

model Order {
  id              String         @id @default(cuid())
  userId          String         @map("user_id")
  status          OrderStatus    @default(PENDING)
  paymentStatus   String         @default("pending") @map("payment_status")
  paymentMethod   String?        @map("payment_method")
  total           Int
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  email           String         @default("")
  isStalkerGift   Boolean        @default(false) @map("is_stalker_gift")
  metadata        Json?
  shippingTotal   Int            @default(0) @map("shipping_total")
  subtotal        Int            @default(0)
  transactionId   String?        @map("transaction_id")
  giftRecipientId String?        @map("gift_recipient_id")
  giftSenderId    String?        @map("gift_sender_id")
  isGiftOrder     Boolean        @default(false) @map("is_gift_order")
  orderAddresses  OrderAddress[]
  items           OrderItem[]
  user            User           @relation(fields: [userId], references: [id])
  stalkerGift     StalkerGift?   @relation("OrderStalkerGift")

  @@index([userId])
  @@index([email])
  @@index([status])
  @@index([paymentStatus])
  @@index([giftSenderId])
  @@index([giftRecipientId])
  @@map("orders")
}

model OrderItem {
  id                  String         @id @default(cuid())
  orderId             String         @map("order_id")
  productId           String         @map("product_id")
  variantId           String         @map("variant_id")
  quantity            Int
  price               Int
  createdAt           DateTime       @default(now()) @map("created_at")
  dropiOrderId        Int?           @map("dropi_order_id")
  dropiShippingCost   Int?           @default(0) @map("dropi_shipping_cost")
  dropiStatus         String?        @map("dropi_status")
  finalPrice          Int            @default(0) @map("final_price")
  updatedAt           DateTime       @updatedAt @map("updated_at")
  dropiDropshipperWin Int?           @default(0) @map("dropi_dropshipper_win")
  dropiWebhookData    Json?          @map("dropi_webhook_data")
  order               Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product             Product        @relation(fields: [productId], references: [id])
  variant             ProductVariant @relation(fields: [variantId], references: [id])

  @@index([dropiOrderId])
  @@map("order_items")
}

model OrderAddress {
  id        String   @id @default(cuid())
  orderId   String   @map("order_id")
  addressId String   @map("address_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  address   Address  @relation(fields: [addressId], references: [id], onDelete: Cascade)
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@unique([orderId, addressId])
  @@index([orderId])
  @@index([addressId])
  @@map("order_addresses")
}

model Address {
  id                String         @id @default(cuid())
  userId            String         @map("user_id")
  firstName         String         @map("first_name")
  lastName          String         @map("last_name")
  phone             String?
  city              String
  state             String
  postalCode        String         @map("postal_code")
  country           String         @default("CO")
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  address1          String         @map("address_1")
  detail            String?
  isDefaultShipping Boolean        @default(false) @map("is_default_shipping")
  metadata          Json?
  isGiftAddress     Boolean        @default(false) @map("is_gift_address")
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderAddresses    OrderAddress[]

  @@map("addresses")
}

model WishList {
  id              String                  @id @default(cuid())
  userId          String                  @map("user_id")
  name            String
  public          Boolean                 @default(false)
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  shareToken      String?                 @unique @map("share_token")
  isAutoGenerated Boolean                 @default(false) @map("is_auto_generated")
  maxItems        Int?                    @map("max_items")
  savedBy         SavedWishlist[]
  items           WishListItem[]
  user            User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessRequests  WishlistAccessRequest[]

  @@map("wish_lists")
}

model WishListItem {
  id         String          @id @default(cuid())
  wishListId String          @map("wish_list_id")
  productId  String          @map("product_id")
  createdAt  DateTime        @default(now()) @map("created_at")
  variantId  String?         @map("variant_id")
  product    Product         @relation(fields: [productId], references: [id])
  variant    ProductVariant? @relation(fields: [variantId], references: [id])
  wishList   WishList        @relation(fields: [wishListId], references: [id], onDelete: Cascade)

  @@map("wish_list_items")
}

model SavedWishlist {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  wishListId String   @map("wish_list_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  wishList   WishList @relation(fields: [wishListId], references: [id], onDelete: Cascade)

  @@unique([userId, wishListId])
  @@map("saved_wishlists")
}

model WishlistAccessRequest {
  id          String    @id @default(cuid())
  wishlistId  String    @map("wishlist_id")
  requesterId String    @map("requester_id")
  status      String    @default("pending")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  respondedAt DateTime? @map("responded_at")
  requester   User      @relation("WishlistAccessRequests", fields: [requesterId], references: [id], onDelete: Cascade)
  wishlist    WishList  @relation(fields: [wishlistId], references: [id], onDelete: Cascade)

  @@unique([wishlistId, requesterId])
  @@index([wishlistId])
  @@index([requesterId])
  @@index([status])
  @@map("wishlist_access_requests")
}

model ProductLike {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  productId String   @map("product_id")
  createdAt DateTime @default(now()) @map("created_at")
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([productId])
  @@index([userId])
  @@map("product_likes")
}

model StalkerGift {
  id                   String            @id @default(cuid())
  orderId              String?           @unique @map("order_id")
  paymentStatus        String            @default("pending") @map("payment_status")
  paymentMethod        String            @default("epayco") @map("payment_method")
  transactionId        String?           @map("transaction_id")
  chatEnabled          Boolean           @default(false) @map("chat_enabled")
  createdAt            DateTime          @default(now()) @map("created_at")
  updatedAt            DateTime          @updatedAt @map("updated_at")
  conversationId       String?           @unique @map("conversation_id")
  acceptedAt           DateTime?         @map("accepted_at")
  estado               StalkerGiftStatus @default(CREATED)
  externalReceiverData Json?             @map("external_receiver_data")
  linkToken            String?           @unique @map("link_token")
  paymentId            String?           @map("payment_id")
  productId            String            @map("product_id")
  quantity             Int               @default(1)
  receiverId           String?           @map("receiver_id")
  senderAlias          String            @map("sender_alias")
  senderId             String            @map("sender_id")
  senderMessage        String?           @map("sender_message")
  uniqueLink           String?           @unique @map("unique_link")
  variantId            String?           @map("variant_id")
  conversation         Conversation?     @relation(fields: [conversationId], references: [id])
  order                Order?            @relation("OrderStalkerGift", fields: [orderId], references: [id])
  product              Product           @relation(fields: [productId], references: [id])
  receiver             User?             @relation("Recipient", fields: [receiverId], references: [id])
  sender               User              @relation("Giver", fields: [senderId], references: [id])
  variant              ProductVariant?   @relation(fields: [variantId], references: [id])

  @@index([senderId])
  @@index([receiverId])
  @@index([uniqueLink])
  @@index([linkToken])
  @@index([estado])
  @@map("stalker_gifts")
}

model DropiProduct {
  id                   String    @id @default(cuid())
  dropiId              Int       @unique @map("dropi_id")
  name                 String
  type                 String
  sku                  String    @unique
  categoryDropiId      Int?      @map("category_dropi_id")
  description          String?
  price                Int
  stock                Int       @default(0)
  warehouseProduct     Json?     @map("warehouse_product")
  variationsData       Json?     @map("variations_data")
  userVerified         Boolean   @default(false) @map("user_verified")
  synced_at            DateTime?
  createdAt            DateTime  @default(now()) @map("created_at")
  updatedAt            DateTime  @updatedAt @map("updated_at")
  categoryDropiIds     Json?     @map("category_dropi_ids")
  descriptionSyncedAt  DateTime? @map("description_synced_at")
  lastPriceStockSyncAt DateTime? @map("last_price_stock_sync_at")
  lastSyncedAt         DateTime? @map("last_synced_at")
  mainImageS3Path      String?   @map("main_image_s3_path")
  suggestedPrice       Int?      @map("suggested_price")
  images               Json?

  @@index([categoryDropiId])
  @@map("dropi_products")
}

model DropiCategory {
  id        String   @id @default(cuid())
  dropiId   Int      @unique @map("dropi_id")
  name      String
  parentId  Int?     @map("parent_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("dropi_categories")
}

model WarehouseVariant {
  id            String         @id @default(cuid())
  variantId     String         @map("variant_id")
  warehouseId   Int            @map("warehouse_id")
  warehouseName String?        @map("warehouse_name")
  warehouseCity String?        @map("warehouse_city")
  stock         Int            @default(0)
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  variant       ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([variantId, warehouseId])
  @@index([variantId])
  @@index([warehouseId])
  @@map("warehouse_variants")
}

model DropiRawProduct {
  id        String   @id @default(cuid())
  dropiId   Int      @map("dropi_id")
  source    String
  payload   Json
  createdAt DateTime @default(now()) @map("created_at")
  syncedAt  DateTime @default(now()) @map("synced_at")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")

  @@unique([dropiId, source])
  @@index([dropiId])
  @@index([source])
  @@index([syncedAt])
  @@map("dropi_raw_products")
}

model Poster {
  id            String           @id @default(cuid())
  customerId    String           @map("customer_id")
  title         String?
  description   String?
  imageUrl      String           @map("image_url")
  videoUrl      String?          @map("video_url")
  likesCount    Int              @default(0) @map("likes_count")
  commentsCount Int              @default(0) @map("comments_count")
  isActive      Boolean          @default(true) @map("is_active")
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")
  comments      PosterComment[]
  reactions     PosterReaction[]
  customer      User             @relation(fields: [customerId], references: [id], onDelete: Cascade)

  @@index([customerId])
  @@index([isActive])
  @@map("posters")
}

model PosterReaction {
  id           String   @id @default(cuid())
  posterId     String   @map("poster_id")
  customerId   String   @map("customer_id")
  reactionType String   @map("reaction_type")
  createdAt    DateTime @default(now()) @map("created_at")
  customer     User     @relation(fields: [customerId], references: [id], onDelete: Cascade)
  poster       Poster   @relation(fields: [posterId], references: [id], onDelete: Cascade)

  @@unique([posterId, customerId])
  @@index([posterId])
  @@index([customerId])
  @@index([reactionType])
  @@map("poster_reactions")
}

model PosterComment {
  id         String          @id @default(cuid())
  posterId   String          @map("poster_id")
  customerId String          @map("customer_id")
  content    String
  parentId   String?         @map("parent_id")
  likesCount Int             @default(0) @map("likes_count")
  isActive   Boolean         @default(true) @map("is_active")
  createdAt  DateTime        @default(now()) @map("created_at")
  updatedAt  DateTime        @updatedAt @map("updated_at")
  mentions   Json?
  customer   User            @relation(fields: [customerId], references: [id], onDelete: Cascade)
  parent     PosterComment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies    PosterComment[] @relation("CommentReplies")
  poster     Poster          @relation(fields: [posterId], references: [id], onDelete: Cascade)

  @@index([posterId])
  @@index([customerId])
  @@index([parentId])
  @@index([createdAt])
  @@map("poster_comments")
}

model StoriesUser {
  id          String      @id @default(cuid())
  customerId  String      @map("customer_id")
  title       String
  description String?
  duration    Int         @default(24)
  viewsCount  Int         @default(0) @map("views_count")
  isActive    Boolean     @default(true) @map("is_active")
  expiresAt   DateTime    @map("expires_at")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  storyType   StoryType   @default(NORMAL) @map("story_type")
  wishlistId  String?     @map("wishlist_id")
  productId   String?     @map("product_id")
  variantId   String?     @map("variant_id")
  customer    User        @relation(fields: [customerId], references: [id], onDelete: Cascade)
  storyFiles  StoryFile[]
  product     Product?    @relation(fields: [productId], references: [id], onDelete: SetNull)

  @@index([customerId])
  @@index([expiresAt])
  @@index([isActive])
  @@index([storyType])
  @@index([wishlistId])
  @@index([productId])
  @@map("stories_user")
}

model StoryFile {
  id         String      @id @default(cuid())
  storyId    String      @map("story_id")
  fileUrl    String      @map("file_url")
  fileType   String      @map("file_type")
  fileSize   Int?        @map("file_size")
  duration   Int?
  orderIndex Int         @default(0) @map("order_index")
  createdAt  DateTime    @default(now()) @map("created_at")
  updatedAt  DateTime    @updatedAt @map("updated_at")
  story      StoriesUser @relation(fields: [storyId], references: [id], onDelete: Cascade)

  @@index([storyId])
  @@index([fileType])
  @@index([storyId, orderIndex])
  @@map("story_files")
}

model DropiJob {
  id         String         @id @default(cuid())
  type       DropiJobType
  status     DropiJobStatus @default(PENDING)
  progress   Int            @default(0)
  attempts   Int            @default(0)
  error      String?
  lockedBy   String?        @map("locked_by")
  lockedAt   DateTime?      @map("locked_at")
  createdAt  DateTime       @default(now()) @map("created_at")
  startedAt  DateTime?      @map("started_at")
  finishedAt DateTime?      @map("finished_at")

  @@index([type, status])
  @@index([status])
  @@index([lockedBy])
  @@map("dropi_jobs")
}

model GlobalRanking {
  id          String   @id @default(cuid())
  itemId      String   @map("item_id")
  itemType    String   @map("item_type")
  globalScore Float    @map("global_score")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@unique([itemId, itemType])
  @@index([globalScore, createdAt])
  @@index([itemType])
  @@map("global_ranking")
}

model ItemMetric {
  id            String   @id @default(cuid())
  itemId        String   @map("item_id")
  itemType      String   @map("item_type")
  wishlistCount Int      @default(0) @map("wishlist_count")
  ordersCount   Int      @default(0) @map("orders_count")
  likesCount    Int      @default(0) @map("likes_count")
  commentsCount Int      @default(0) @map("comments_count")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@unique([itemId, itemType])
  @@index([itemType])
  @@map("item_metrics")
}

model Friend {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  friendId  String   @map("friend_id")
  status    String
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  friend    User     @relation("FriendOf", fields: [friendId], references: [id], onDelete: Cascade)
  user      User     @relation("UserFriends", fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, friendId])
  @@index([userId, status])
  @@index([friendId, status])
  @@map("friends")
}

model Notification {
  id        String    @id @default(cuid())
  userId    String    @map("user_id")
  type      String
  title     String
  message   String
  data      Json?
  isRead    Boolean   @default(false) @map("is_read")
  createdAt DateTime  @default(now()) @map("created_at")
  readAt    DateTime? @map("read_at")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, isRead])
  @@index([userId, createdAt])
  @@map("notifications")
}

model Group {
  id          String        @id @default(cuid())
  userId      String        @map("user_id")
  name        String
  description String?
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  members     GroupMember[]
  owner       User          @relation("GroupOwner", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("groups")
}

model GroupMember {
  id        String   @id @default(cuid())
  groupId   String   @map("group_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")
  group     Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
  @@map("group_members")
}

model Conversation {
  id           String                    @id @default(cuid())
  type         ConversationType          @default(FRIENDS)
  status       ConversationStatus        @default(ACTIVE)
  createdAt    DateTime                  @default(now()) @map("created_at")
  updatedAt    DateTime                  @updatedAt @map("updated_at")
  participants ConversationParticipant[]
  messages     Message[]
  stalkerGift  StalkerGift?

  @@index([type, status])
  @@index([status])
  @@map("conversations")
}

model ConversationParticipant {
  id             String       @id @default(cuid())
  conversationId String       @map("conversation_id")
  userId         String       @map("user_id")
  alias          String?
  isRevealed     Boolean      @default(false) @map("is_revealed")
  createdAt      DateTime     @default(now()) @map("created_at")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId])
  @@index([conversationId])
  @@index([userId])
  @@map("conversation_participants")
}

model Message {
  id             String        @id @default(cuid())
  conversationId String        @map("conversation_id")
  senderId       String        @map("sender_id")
  senderAlias    String?       @map("sender_alias")
  content        String
  type           MessageType   @default(TEXT)
  status         MessageStatus @default(SENT)
  readAt         DateTime?     @map("read_at")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  conversation   Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User          @relation(fields: [senderId], references: [id])

  @@index([conversationId, createdAt])
  @@index([senderId])
  @@index([status])
  @@map("messages")
}

model UserConsent {
  id            String   @id @default(cuid())
  userId        String   @map("user_id")
  consentType   String   @map("consent_type")
  policyVersion String   @map("policy_version")
  acceptedAt    DateTime @default(now()) @map("accepted_at")
  ipHash        String?  @map("ip_hash")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, consentType, policyVersion])
  @@index([userId])
  @@index([consentType])
  @@map("user_consents")
}

model Department {
  id             Int      @id
  name           String
  departmentCode String?  @map("department_code")
  countryId      Int?     @map("country_id")
  dropiId        Int      @unique @map("dropi_id")
  payload        Json?
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  cities         City[]

  @@index([dropiId])
  @@map("departments")
}

model City {
  id             Int        @id
  name           String
  departmentId   Int        @map("department_id")
  rateType       String?    @map("rate_type")
  trajectoryType String?    @map("trajectory_type")
  code           String?
  dropiId        Int        @unique @map("dropi_id")
  payload        Json?
  createdAt      DateTime   @default(now()) @map("created_at")
  updatedAt      DateTime   @updatedAt @map("updated_at")
  department     Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)

  @@index([departmentId])
  @@index([dropiId])
  @@map("cities")
}

enum DropiJobType {
  RAW
  NORMALIZE
  ENRICH
  SYNC_PRODUCT
  SYNC_STOCK
}

enum DropiJobStatus {
  PENDING
  RUNNING
  DONE
  FAILED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum StalkerGiftStatus {
  CREATED
  PAID
  WAITING_ACCEPTANCE
  ACCEPTED
  REJECTED
  CANCELLED
}

enum ConversationType {
  FRIENDS
  STALKERGIFT
}

enum ConversationStatus {
  ACTIVE
  CLOSED
}

enum MessageType {
  TEXT
  IMAGE
  FILE
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
}

enum StoryType {
  NORMAL
  WISHLIST
}
